
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>STM32 Analog to digital converter (ADC) &#8212; STM32 programming by examples 1.0 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="STM32 Universal asynchronous receiver transmitter (UART)" href="stm32-uart.html" />
    <link rel="prev" title="STM32 Direct memory access (DMA) controller" href="stm32-dma.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">STM32 programming by examples 1.0 documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Peripherals:
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stm32-gpio.html">
   STM32 GPIO
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stm32-timer.html">
   STM32 Timer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stm32-dma.html">
   STM32 DMA
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   STM32 ADC
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stm32-uart.html">
   STM32 UART
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stm32-rtc.html">
   STM32 RTC
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stm32-low-power.html">
   STM32 Low power
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stm32-i2c.html">
   STM32 I2C
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stm32-spi.html">
   STM32 SPI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stm32-advanced-timer.html">
   STM32 Advanced timer
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Applications
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../motor-control/sine-pwm.html">
   SinePWM
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../motor-control/sv-pwm.html">
   SV-PWM
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../motor-control/field-oriented-control.html">
   Field oriented control
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../motor-control/direct-torque-control.html">
   Direct torque control
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/peripherals/stm32-adc.rst.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.rst</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#configure-the-adc-for-polling">
   Configure the ADC for polling
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#self-calibration">
     Self calibration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sequencer-configuration">
     Sequencer configuration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#temperature-battery-and-reference-voltage-channel">
     Temperature, battery, and reference voltage channel
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#continuos-conversion-and-interrupt">
   Continuos conversion and interrupt
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#continuos-conversion-and-dma">
   Continuos conversion and DMA
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>STM32 Analog to digital converter (ADC)</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#configure-the-adc-for-polling">
   Configure the ADC for polling
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#self-calibration">
     Self calibration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sequencer-configuration">
     Sequencer configuration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#temperature-battery-and-reference-voltage-channel">
     Temperature, battery, and reference voltage channel
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#continuos-conversion-and-interrupt">
   Continuos conversion and interrupt
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#continuos-conversion-and-dma">
   Continuos conversion and DMA
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="stm32-analog-to-digital-converter-adc">
<h1>STM32 Analog to digital converter (ADC)<a class="headerlink" href="#stm32-analog-to-digital-converter-adc" title="Permalink to this headline">#</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This article is a work in progress</p>
</div>
<p>The ADC supports 12 external channels, as well as 4 internal channels. The internal channels are connected to a temperature sensor, a reference voltage, one of the DAC outputs, and the battery supply pin of the microcontroller.</p>
<section id="configure-the-adc-for-polling">
<h2>Configure the ADC for polling<a class="headerlink" href="#configure-the-adc-for-polling" title="Permalink to this headline">#</a></h2>
<section id="self-calibration">
<h3>Self calibration<a class="headerlink" href="#self-calibration" title="Permalink to this headline">#</a></h3>
<p>The ADC has a build in calibration feature where it calculates a error correction value for each of the internal sampling capacitors. It is recommended to run this calibration on start up of the microcontroller, before the ADC is used.</p>
</section>
<section id="sequencer-configuration">
<h3>Sequencer configuration<a class="headerlink" href="#sequencer-configuration" title="Permalink to this headline">#</a></h3>
<p>The ADC in the STM32 uses a configurable sequencer to automatically step through the various input channels in order to continuously convert multiple inputs. Even if you are manually triggering the conversion from software, the sequencer must be configured for the channels of interest. Each time you initiate a conversion the ADC peripheral will select the next input in the sequence, wrapping around as it finished with the last input.</p>
<p>The channels in the sequencer can be placed in any arbitrary order.</p>
<p>If you insist on the “Arduino way” of doing things (i.e. a call to some function such as: <code class="code docutils literal notranslate"><span class="pre">adc_read(channel_1)</span></code> should initiate a conversion on the specified channel and return the converted value), you will have to implement some library around the low level API. Such libraries are available, but if you think that you want to do it this way you are (probably) wrong.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">LL_ADC_REG_SetSequencerRanks</span><span class="p">(</span><span class="n">ADC</span><span class="p">,</span><span class="w"> </span><span class="n">LL_ADC_REG_RANK_1</span><span class="p">,</span><span class="w"> </span><span class="n">LL_ADC_CHANNEL_4</span><span class="p">);</span>
<span class="n">LL_ADC_REG_SetSequencerRanks</span><span class="p">(</span><span class="n">ADC</span><span class="p">,</span><span class="w"> </span><span class="n">LL_ADC_REG_RANK_2</span><span class="p">,</span><span class="w"> </span><span class="n">LL_ADC_CHANNEL_5</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">LL_ADC_REG_ReadConversionData12</span><span class="p">(</span><span class="n">ADC</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="temperature-battery-and-reference-voltage-channel">
<h3>Temperature, battery, and reference voltage channel<a class="headerlink" href="#temperature-battery-and-reference-voltage-channel" title="Permalink to this headline">#</a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">LL_ADC_REG_SetSequencerRanks</span><span class="p">(</span><span class="n">ADC</span><span class="p">,</span><span class="w"> </span><span class="n">LL_ADC_REG_RANK_1</span><span class="p">,</span><span class="w"> </span><span class="n">LL_ADC_CHANNEL_TEMPSENSOR</span><span class="p">);</span>
<span class="n">LL_ADC_SetChannelSamplingTime</span><span class="p">(</span><span class="n">ADC</span><span class="p">,</span><span class="w"> </span><span class="n">LL_ADC_CHANNEL_TEMPSENSOR</span><span class="p">,</span><span class="w"> </span><span class="n">LL_ADC_SAMPLINGTIME_39CYCLES_5</span><span class="p">);</span>
<span class="n">LL_ADC_SetCommonPathInternalCh</span><span class="p">(</span><span class="n">__LL_ADC_COMMON_INSTANCE</span><span class="p">(</span><span class="n">ADC</span><span class="p">),</span><span class="w"> </span><span class="n">LL_ADC_PATH_INTERNAL_TEMPSENSOR</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">LL_ADC_PATH_INTERNAL_VREFINT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">LL_ADC_PATH_INTERNAL_VBAT</span><span class="p">);</span>

<span class="n">LL_ADC_REG_SetSequencerRanks</span><span class="p">(</span><span class="n">ADC</span><span class="p">,</span><span class="w"> </span><span class="n">LL_ADC_REG_RANK_2</span><span class="p">,</span><span class="w"> </span><span class="n">LL_ADC_CHANNEL_VREFINT</span><span class="p">);</span>
<span class="n">LL_ADC_SetChannelSamplingTime</span><span class="p">(</span><span class="n">ADC</span><span class="p">,</span><span class="w"> </span><span class="n">LL_ADC_CHANNEL_VREFINT</span><span class="p">,</span><span class="w"> </span><span class="n">LL_ADC_SAMPLINGTIME_39CYCLES_5</span><span class="p">);</span>

<span class="n">LL_ADC_REG_SetSequencerRanks</span><span class="p">(</span><span class="n">ADC</span><span class="p">,</span><span class="w"> </span><span class="n">LL_ADC_REG_RANK_3</span><span class="p">,</span><span class="w"> </span><span class="n">LL_ADC_CHANNEL_VBAT</span><span class="p">);</span>
<span class="n">LL_ADC_SetChannelSamplingTime</span><span class="p">(</span><span class="n">ADC</span><span class="p">,</span><span class="w"> </span><span class="n">LL_ADC_CHANNEL_VBAT</span><span class="p">,</span><span class="w"> </span><span class="n">LL_ADC_SAMPLINGTIME_39CYCLES_5</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>
<section id="continuos-conversion-and-interrupt">
<h2>Continuos conversion and interrupt<a class="headerlink" href="#continuos-conversion-and-interrupt" title="Permalink to this headline">#</a></h2>
<p>If continuous conversions are needed it is possible to use a hardware timer to initiate them. A interrupt on the timer can then be used to activate the ADC. Alternatively a software timer, or time event generator can also be used.</p>
<p>The ADC is capable of generating an interrupt on end of conversion. This interrupt can be used to signal the main application that new data is available, e.g. by publishing a “ADC_EVENT” signal.</p>
</section>
<section id="continuos-conversion-and-dma">
<h2>Continuos conversion and DMA<a class="headerlink" href="#continuos-conversion-and-dma" title="Permalink to this headline">#</a></h2>
<p>The DMA is the most efficient way to transfer converted data to memory. It is the ideal solution if high conversion rates are needed, but it might also be used with lower conversion rates.</p>
<p>The DMA controller has multiple channels, and could be utilized for several different peripherals in a single application. If this is the case it becomes important to verify that there are no conflicts in the DMA setup. Make sure that you perform thorough testing of all peripherals after making adjustments in the configuration of a single peripheral. In practice this should be performed automatically by means of unit and integration testing.</p>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="stm32-dma.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">STM32 Direct memory access (DMA) controller</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="stm32-uart.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">STM32 Universal asynchronous receiver transmitter (UART)</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Eirik Haustveit<br/>
  
      &copy; Copyright 2023, Eirik Haustveit.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>