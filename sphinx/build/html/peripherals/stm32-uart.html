
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>STM32 Universal asynchronous receiver transmitter (UART) &#8212; STM32 programming by examples 1.0 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="STM32 Universal asynchronous receiver transmitter (UART) DMA" href="stm32-uart-dma.html" />
    <link rel="prev" title="STM32 Analog to digital converter (ADC)" href="stm32-adc.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">STM32 programming by examples 1.0 documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Peripherals:
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stm32-gpio.html">
   STM32 GPIO
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stm32-timer.html">
   STM32 Timer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stm32-dma.html">
   STM32 DMA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stm32-adc.html">
   STM32 ADC
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   STM32 UART
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stm32-uart-dma.html">
   STM32 UART with DMA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stm32-rtc.html">
   STM32 RTC
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stm32-low-power.html">
   STM32 Low power
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stm32-i2c.html">
   STM32 I2C
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stm32-spi.html">
   STM32 SPI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stm32-advanced-timer.html">
   STM32 Advanced timer
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Core:
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../core/cortex-hardfault-debug.html">
   Cortex hardfault debug
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../core/stm32-clock.html">
   STM32 Clock
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Applications
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../motor-control/sine-pwm.html">
   SinePWM
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../motor-control/sv-pwm.html">
   SV-PWM
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../motor-control/field-oriented-control.html">
   Field oriented control
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../motor-control/direct-torque-control.html">
   Direct torque control
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Libraries
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../libraries/erpc.html">
   eRPC
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../libraries/protocol-buffer.html">
   Protocol buffer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../libraries/telemetry.html">
   Telemetry
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../libraries/qpc.html">
   QPC
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/peripherals/stm32-uart.rst.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.rst</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-the-hal-for-rx-and-tx">
   Using the HAL for RX and TX
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#receive-using-polling">
     Receive using polling
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#receive-using-interrupts">
     Receive using interrupts
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-the-low-level-ll-drivers">
   Using the low level (LL) drivers
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#circular-buffer-for-uart-rx-and-tx-with-interrupts">
   Circular buffer for UART RX and TX with interrupts
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>STM32 Universal asynchronous receiver transmitter (UART)</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-the-hal-for-rx-and-tx">
   Using the HAL for RX and TX
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#receive-using-polling">
     Receive using polling
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#receive-using-interrupts">
     Receive using interrupts
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-the-low-level-ll-drivers">
   Using the low level (LL) drivers
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#circular-buffer-for-uart-rx-and-tx-with-interrupts">
   Circular buffer for UART RX and TX with interrupts
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="stm32-universal-asynchronous-receiver-transmitter-uart">
<h1>STM32 Universal asynchronous receiver transmitter (UART)<a class="headerlink" href="#stm32-universal-asynchronous-receiver-transmitter-uart" title="Permalink to this headline">#</a></h1>
<p>There is very little to learn from blindly following a guide to achieve some goal, and this page does not attempt to provide every little detail which is required in order for UART to work in your project. The reader should understand each step, in order to be able to read between the lines the extra steps which are required. By “extra steps” is meant such things as the proper declaration of variables and functions, the inclusion of initialization code generated from CubeMX, etc. An understanding of the C language is thus also required.</p>
<section id="using-the-hal-for-rx-and-tx">
<h2>Using the HAL for RX and TX<a class="headerlink" href="#using-the-hal-for-rx-and-tx" title="Permalink to this headline">#</a></h2>
<p>A quick google search will reveal a lot of STM32 UART examples which are not amazing. They might work for the simple demonstration that they provide, but they are not easy to extend to something useful. Some examples are good, but the reader needs to be careful. Especially the HAL library is not too flexible.</p>
<p>The conclusion is that it is probably better to stick with the low level (LL) drivers, and possibly add some application specific high level abstractions on top of them. Still the basics of the UART HAL drivers should be understood in case one encounters them in some applications or example code.</p>
<p>The <code class="code docutils literal notranslate"><span class="pre">printf()</span></code> family of functions is nice if you want to manipulate strings. A quick way to integrate it with the HAL UART drivers is as follows:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">char</span><span class="w"> </span><span class="n">uart_tx_buf</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>

<span class="n">sprintf</span><span class="p">(</span><span class="n">uart_tx_buf</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Test</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="n">HAL_UART_Transmit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">huart1</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="n">uart_tx_buf</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">uart_tx_buf</span><span class="p">),</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span>
</pre></div>
</div>
<section id="receive-using-polling">
<h3>Receive using polling<a class="headerlink" href="#receive-using-polling" title="Permalink to this headline">#</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This section needs to be written</p>
</div>
</section>
<section id="receive-using-interrupts">
<h3>Receive using interrupts<a class="headerlink" href="#receive-using-interrupts" title="Permalink to this headline">#</a></h3>
<p>The <code class="code docutils literal notranslate"><span class="pre">HAL_UART_Receive_IT(&amp;huart1,</span> <span class="pre">&amp;uart_rx_buf,</span> <span class="pre">number_of_bytes);</span></code> configures a interrupt to receive a specified number of bytes. This function is not particularly useful as we would normally want to receive whatever the UART sees, not a specific number of bytes. It is possible to set the number of bytes to one, and call the function each time a byte is received, but the author has found the reliability of this approach to be less than adequate. It is better to simply enable receive interrupts, and handle the received data in an ISR:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">__HAL_UART_ENABLE_IT</span><span class="p">(</span><span class="o">&amp;</span><span class="n">huart1</span><span class="p">,</span><span class="w"> </span><span class="n">UART_IT_RXNE</span><span class="p">);</span>
</pre></div>
</div>
<p>The ISR for USART1 can then simply use the non-interrupt version of the UART receive functions <code class="code docutils literal notranslate"><span class="pre">HAL_UART_Receive();</span></code> to acquire the received byte:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">uart_rx_char</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00</span><span class="p">;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">USART1_IRQHandler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">HAL_UART_Receive</span><span class="p">(</span><span class="o">&amp;</span><span class="n">huart1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">uart_rx_char</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="w">    </span><span class="c1">//HAL_UART_IRQHandler(&amp;huart1); // We do not need to call the HAL interrupt handler</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Low level access to the UART receive buffer through direct register read or the low level (LL) API will probably be more efficient, but here we are discussing the HAL drivers.</p>
<p>In the above example a single byte buffer is used, but typically one would implement a ring (FIFO) buffer where the ISR places each received byte. If the buffer is full it could either drop the latest received data, or overwrite the oldest data in the ring.</p>
</section>
</section>
<section id="using-the-low-level-ll-drivers">
<h2>Using the low level (LL) drivers<a class="headerlink" href="#using-the-low-level-ll-drivers" title="Permalink to this headline">#</a></h2>
</section>
<section id="circular-buffer-for-uart-rx-and-tx-with-interrupts">
<h2>Circular buffer for UART RX and TX with interrupts<a class="headerlink" href="#circular-buffer-for-uart-rx-and-tx-with-interrupts" title="Permalink to this headline">#</a></h2>
<p><a class="reference external" href="https://github.com/atakansarioglu/c-circus">https://github.com/atakansarioglu/c-circus</a>
<a class="reference external" href="https://github.com/AndersKaloer/Ring-Buffer">https://github.com/AndersKaloer/Ring-Buffer</a></p>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="stm32-adc.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">STM32 Analog to digital converter (ADC)</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="stm32-uart-dma.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">STM32 Universal asynchronous receiver transmitter (UART) DMA</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Eirik Haustveit<br/>
  
      &copy; Copyright 2023, Eirik Haustveit.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>